"use strict";(self.webpackChunkmyapp=self.webpackChunkmyapp||[]).push([[169],{4169:(Y,R,g)=>{g.r(R),g.d(R,{ViewLivesheetModule:()=>V});var W=g(9965),p=g(8621),B=g(5108),k=g(5439),C=g(7579),a=g(8256);let O=(()=>{class u{constructor(){this._recorded=new C.x,this._recordingTime=new C.x,this._recordingFailed=new C.x}getRecordedBlob(){return this._recorded.asObservable()}getRecordedTime(){return this._recordingTime.asObservable()}recordingFailed(){return this._recordingFailed.asObservable()}startRecording(){this.recorder||(this._recordingTime.next("00:00"),navigator.mediaDevices.getUserMedia({audio:{channelCount:1}}).then(e=>{this.stream=e,this.record()}).catch(e=>{this._recordingFailed.next("k")}))}abortRecording(){this.stopMedia()}record(){this.recorder=new B.StereoAudioRecorder(this.stream,{type:"audio",mimeType:"audio/wav",numberOfAudioChannels:1}),this.recorder.record(),this.startTime=k(),this.interval=setInterval(()=>{const n=k(),e=k.duration(n.diff(this.startTime)),t=this.toString(e.minutes())+":"+this.toString(e.seconds());this._recordingTime.next(t)},1e3)}toString(n){let e=n;return n||(e="00"),n<10&&(e="0"+n),e}stopRecording(){this.recorder&&this.recorder.stop(n=>{if(this.startTime){const e=encodeURIComponent("audio_"+(new Date).getTime()+".mp3");this.stopMedia(),this._recorded.next({blob:n,title:e})}},()=>{this.stopMedia(),this._recordingFailed.next("h")})}stopMedia(){this.recorder&&(this.recorder=null,clearInterval(this.interval),this.startTime=null,this.stream&&(this.stream.getAudioTracks().forEach(n=>n.stop()),this.stream=null))}}return u.\u0275fac=function(n){return new(n||u)},u.\u0275prov=a.Yz7({token:u,factory:u.\u0275fac}),u})();var S=g(2340),H=g(529),T=g(4981),L=g(1481),Z=g(6895),q=g(5593),I=g(1493);function D(u,v){if(1&u){const n=a.EpF();a.TgZ(0,"button",9),a.NdJ("click",function(){a.CHM(n);const t=a.oxw();return a.KtG(t.attemptWorksheet())}),a.qZA()}}function U(u,v){if(1&u){const n=a.EpF();a.TgZ(0,"button",10),a.NdJ("click",function(){a.CHM(n);const t=a.oxw();return a.KtG(t.retake())}),a.qZA()}}function N(u,v){if(1&u&&(a.TgZ(0,"div")(1,"video",11),a._UZ(2,"source",12),a._uU(3," Your browser does not support HTML5 video. "),a.qZA()()),2&u){const n=a.oxw();a.xp6(2),a.Q6J("src",n.urls,a.LSH)}}function _(u,v){if(1&u&&(a.TgZ(0,"div")(1,"audio",13),a._UZ(2,"source",14),a._uU(3," Your browser does not support HTML5 audio. "),a.qZA()()),2&u){const n=a.oxw();a.xp6(2),a.Q6J("src",n.urls,a.LSH)}}function M(u,v){if(1&u&&(a.TgZ(0,"div")(1,"audio",13),a._UZ(2,"source",14),a._uU(3," Your browser does not support HTML5 audio. "),a.qZA()()),2&u){const n=a.oxw();a.xp6(2),a.Q6J("src",n.urls,a.LSH)}}function b(u,v){if(1&u&&(a.TgZ(0,"div"),a._UZ(1,"iframe",15),a.qZA()),2&u){const n=a.oxw();a.xp6(1),a.Q6J("src",n.safeurls,a.uOi)}}const z=[{path:"",component:(()=>{class u{constructor(n,e,t,i,r,o){this.route=n,this.router=e,this.http=t,this.userService=i,this.sanitizer=r,this.audioRecordingService=o,this.title="Attempt Worksheet",this.data="",this.answers=[],this.newanswers=[],this.correctOptions=[],this.userOptions=[],this.checkBoxAnswers=[],this.checkBoxNewAnswers=[],this.radioAnswers=[],this.radioNewAnswers=[],this.dragAndDropAreas=[],this.dragAndDropObjects=[],this.dropdownArray=[],this.qArrows=[],this.aArrows=[],this.lineArrows=[],this.dropdownUser=[],this.dropdownAnswers=[],this.wordSearchWords=[],this.searchCorrectLetter=[],this.searchUserLetter=[],this.hidden=!0,this.isDrawing=!1,this.isAdmin=!1,this.isLoggedIn=!1,this.isDrawLine=!1,this.lineDrawn=!1,this.answerResult=0,this.checkboxResult=0,this.radioResult=0,this.optionsResult=0,this.wordSearchResult=0,this.dragAndDropResult=0,this.arrowResult=0,this.dropdownResult=0,this.result=0,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.checkBoxQuestions=0,this.radioQuestions=0,this.mcQuestions=0,this.textboxQuestions=0,this.displayBasic2=!1,this.isPlaying=!1,this.transcription="speak...",this.displayControls=!0,this.isRecording=!1,this.isSilenceLogged=!1,this.isBlinking=!1,this.canvasHeight=1e3,this.canvasWidth=700,this.isFirstLoad=!0,this.recordedChunks=[],this.silenceThreshold=100,this.silenceDuration=3e3,this.updateCanvasSize=()=>{const s=JSON.parse(this.json).objects.find(c=>"size"===c.id);s.height>=1e3?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.3),this.canvas.setWidth(650),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.16),this.canvas.setZoom(.85),this.canvas.setWidth(600)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.3),this.canvas.setWidth(540)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.4),this.canvas.setWidth(500)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.55),this.canvas.setWidth(450)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.78),this.canvas.setWidth(400)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.95),this.canvas.setWidth(365)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.18),this.canvas.setWidth(320)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.38),this.canvas.setWidth(270),this.canvas.setHeight(s.height/2.6)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(220),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.22),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.4)):s.height<1e3&&s.height>=900?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.1),this.canvas.setWidth(650),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.18),this.canvas.setZoom(.85),this.canvas.setWidth(600)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.34),this.canvas.setWidth(540)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.43),this.canvas.setWidth(500)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.58),this.canvas.setWidth(450)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.81),this.canvas.setWidth(400)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.98),this.canvas.setWidth(365)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.21),this.canvas.setWidth(320)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.38),this.canvas.setWidth(270),this.canvas.setHeight(s.height/2.6)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(220),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.22),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.2)):s.height<900&&s.height>=800?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.11),this.canvas.setWidth(650),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.16),this.canvas.setZoom(.85),this.canvas.setWidth(590)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.31),this.canvas.setWidth(520)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.41),this.canvas.setWidth(490)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.58),this.canvas.setWidth(440)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.81),this.canvas.setWidth(380)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.98),this.canvas.setWidth(350)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.21),this.canvas.setWidth(310)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.38),this.canvas.setWidth(260),this.canvas.setHeight(s.height/2.6)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(215),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.22),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.2)):s.height<800&&s.height>=500?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.11),this.canvas.setWidth(640),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.2),this.canvas.setZoom(.85),this.canvas.setWidth(590)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.35),this.canvas.setWidth(520)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.45),this.canvas.setWidth(490)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.62),this.canvas.setWidth(440)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.84),this.canvas.setWidth(380)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/2.05),this.canvas.setWidth(350)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.26),this.canvas.setWidth(310)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.37),this.canvas.setWidth(260),this.canvas.setHeight(s.height/2.7)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(215),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.21),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.5)):s.height<600&&s.height>=400?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.105),this.canvas.setWidth(640),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.15),this.canvas.setZoom(.85),this.canvas.setWidth(590)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.3),this.canvas.setWidth(520)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.4),this.canvas.setWidth(490)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.55),this.canvas.setWidth(440)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.8),this.canvas.setWidth(380)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.9),this.canvas.setWidth(350)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.24),this.canvas.setWidth(320)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.37),this.canvas.setWidth(260),this.canvas.setHeight(s.height/2.7)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(215),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.21),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.5)):s.height<600&&s.height>=300&&(this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.09),this.canvas.setWidth(640),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.15),this.canvas.setZoom(.85),this.canvas.setWidth(590)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.3),this.canvas.setWidth(520)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.4),this.canvas.setWidth(490)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.55),this.canvas.setWidth(440)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.8),this.canvas.setWidth(380)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.9),this.canvas.setWidth(350)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.19),this.canvas.setWidth(320)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.37),this.canvas.setWidth(260),this.canvas.setHeight(s.height/2.5)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(215),this.canvas.setHeight(s.height/3.1)):this.windowWidth<250&&(this.canvas.setZoom(.21),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.5)))},this.token=localStorage.getItem("token"),this.audioRecordingService.recordingFailed().subscribe(()=>{this.isRecording=!1}),this.audioRecordingService.getRecordedTime().subscribe(h=>{this.recordedTime=h}),this.audioRecordingService.getRecordedBlob().subscribe(h=>{this.blobUrl=this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(h.blob))})}reloadCurrentPage(){window.location.reload()}playAudio(n){this.audioContext.decodeAudioData(n.buffer,t=>{this.audioSource=this.audioContext.createBufferSource(),this.audioSource.buffer=t,this.audioSource.connect(this.audioContext.destination),this.audioSource.start(0)})}stopAudio(){this.audioSource&&this.audioSource.stop()}ngOnInit(){this.router.events.subscribe(e=>{e instanceof W.m2&&this.isFirstLoad&&(this.isFirstLoad=!1,location.reload())}),this.audioContext=new AudioContext,this.userService.getUserRole().subscribe(e=>{this.myRole=e,this.isLoggedIn=this.token&&("admin"===this.myRole||"user"===this.myRole),this.isAdmin=this.token&&"admin"===this.myRole});const n=this.route.snapshot.paramMap.get("id");this.userService.getSheetById(n).subscribe(e=>{this.sheetDetails=e.data,this.json=e.data.liveWorksheetJson,this.createFabricCanvas(),this.loadFromJson(),this.updateCanvasSize()},e=>{console.error("Failed to retrieve sheet details:",e)})}onResize(n){this.windowWidth=n.target.innerWidth,this.windowHeight=n.target.innerHeight}createFabricCanvas(){this.canvas=new p.fabric.Canvas("canvas")}drawShape(n,e){let t,i;n.off("mouse:down"),n.off("mouse:up");let h=0;n.on("mouse:down",s=>{this.isDrawing=!0;const c=s.target;if(c&&"rect"===c.type&&!0===c.qArrow){c.hoverCursor="pointer";const d=n.getPointer(s.e),l=[d.x,d.y,d.x,d.y],w=this.lineArrows.findIndex(A=>A.textBoxId===c.id);if(w>-1){const A=this.lineArrows[w].line;n.remove(A),n.remove(i),this.lineArrows.splice(w,1),h=A.get("id")}t=new p.fabric.Line(l,{fill:"transparent",stroke:"blue",strokeWidth:3,selectable:!1});let x=Math.atan2(t.y2-t.y1,t.x2-t.x1);x*=180/Math.PI,x+=90,i=new p.fabric.Triangle({angle:x,fill:"blue",selectable:!1,top:t.y2,left:t.x2,width:15,height:15,originX:"center",originY:"center",stroke:"black"}),p.fabric.Group.prototype.toObject=(A=p.fabric.Group.prototype.toObject,function(y){return y=(y||[]).concat(["id"]),A.apply(this,[y])}),t.set("id",h+1),n.add(t),n.add(i),n.renderAll(),this.lineArrows.push({line:t,textBoxId:c.id}),h++}var A}),n.on("mouse:move",s=>{if(this.isDrawing&&"arrow"===e){const c=n.getPointer(s.e);t.set({x2:c.x,y2:c.y});let w=Math.atan2(t.y2-t.y1,t.x2-t.x1);w*=180/Math.PI,w+=90,i.set({top:t.y2,left:t.x2,angle:w,width:15,height:15}),n.renderAll()}}),n.on("mouse:up",s=>{if(this.isDrawing&&"arrow"===e){this.isDrawing=!1;for(const c of this.lineArrows){const d=this.qArrows.findIndex(l=>c.line.x1>=l.left&&c.line.x1<=l.right&&c.line.y1>=l.top&&c.line.y1<=l.bottom);if(-1!==d){const l=this.qArrows[d],w=this.aArrows.find(f=>c.line.x2>=f.left&&c.line.x2<=f.right&&c.line.y2>=f.top&&c.line.y2<=f.bottom);if(!l||!w){this.canvas.remove(c.line),this.canvas.remove(i);const f=this.lineArrows.indexOf(c);this.lineArrows.splice(f,1)}}}t=null}}),this.isDrawing=!1}loadFromJson(){const n=this.route.snapshot.paramMap.get("id");this.router.navigate([`liveworksheet-details/${n}`]);const e=JSON.parse(this.json);e||location.reload(),e&&this.canvas.loadFromJSON(e,()=>{this.canvas.selection=!1,this.canvas.selection=!1,this.canvas.forEachObject(t=>{if(t.hoverCursor="pointer",t.selectable=!1,t.lockScalingX=!0,t.lockScalingY=!0,t.hasControls=!1,"size"===t.id&&(this.windowWidth>750?(this.canvas.setWidth(t.width),this.canvas.setHeight(t.height)):this.updateCanvasSize(),this.canvas.renderAll()),t&&"rect"===t.type&&!0===t.aArrow&&"size"!==t.id&&(t.evented=!0,t.set("fill","transparent"),t.set("stroke","transparent"),this.aArrows.push({id:t.id,left:t.left,top:t.top,right:t.left+t.width*t.scaleX,bottom:t.top+t.height*t.scaleY}),this.canvas.on("mouse:up",o=>{})),t&&"rect"===t.type&&!0===t.qArrow&&"size"!==t.id&&(this.isDrawing=!0,t.evented=!0,t.set("stroke","transparent"),t.set("fill","transparent"),this.qArrows.push({id:t.id,left:t.left,top:t.top,right:t.left+t.width*t.scaleX,bottom:t.top+t.height*t.scaleY}),this.canvas.on("mouse:over",o=>{t.hoverCursor="crosshair",this.lineDrawn=!0}),this.canvas.on("mouse:down",o=>{this.lineDrawn=!0;const h=o.target;h&&"rect"===h.type&&!0===h.qArrow&&"size"!==t.id&&(t.set("fill","transparent"),this.drawShape(this.canvas,"arrow"),this.canvas.renderAll())})),t&&"rect"===t.type&&"mainrect"===t.id&&"size"!==t.id&&(t.on("mouse:over",function(r){r.target.set("hoverCursor","pointer"),this.canvas.renderAll()}),t.searchdata.map(r=>{const o={question:r.word?.split(")")[0],word:r.letters};this.wordSearchWords.push(o)})),t&&"rect"===t.type&&"smallrects"===t.types&&"size"!==t.id)this.searchCorrectLetter.push(t.id),t.set("fill","transparent"),t.on("mousedown",()=>{-1===this.searchUserLetter.findIndex(o=>o.letter===t.id)?this.searchUserLetter.push({letter:t.id}):this.searchUserLetter=this.searchUserLetter.filter(o=>t.id!==o.letter),this.canvas.selection=!1,"transparent"===t.fill?(t.set("value",!0),t.set({fill:"rgba(0, 0, 255, 0.5)"})):(t.set({fill:"transparent"}),t.set("value",!1)),this.canvas.renderAll()});else if(t&&"rect"===t.type&&!0===t.droparea&&"size"!==t.id)this.dragAndDropAreas.push({id:t.id,text:t.text,obj:t});else if(!t||"textbox"!==t.type||!0!==t.dropobject||t.id.id||t.id.unique)if(!t||"image"!==t.type||!0!==t.dropobject||t.id.id||t.id.unique)if("i-text"===t.type&&"link"===t.id&&t.link)t.selectable=!1,t.lockScalingX=!1,t.evented=!0,t.lockScalingY=!1,t.on("mousedown",()=>{window.open(t.link,"_blank")});else if("i-text"===t.type&&"mediaLink"===t.id&&t.link)t.selectable=!1,t.lockScalingX=!1,t.evented=!0,t.lockScalingY=!1,t.on("mousedown",r=>{this.showBasicDialog2(t.link)});else if("textbox"!==t.type||!0!==this.hidden||t.dropobject||t.aArrow||t.qArrow||t.option||t.id.id||t.id.unique||t.exercise)if("textbox"!==t.type||!t.option||t.id.id||t.id.unique)if("circle"===t.type&&!0===this.hidden){t.selectable=!0,t.lockMovementY=!0,t.lockMovementX=!0,t.lockUniScaling=!0,t.editable=!0;const r={id:t.id,value:t.option.slice(2,999),question:t.option.slice(0,2)};this.radioAnswers.push(r),t.set("fill","transparent");let o=!1,h="false";t.on("mousedown",s=>{o=!o,!0===o?t.set("fill","black"):!1===o&&t.set("fill","transparent");const c=this.radioNewAnswers.findIndex(d=>d.id===t.id);h=o?"true":"false",-1===c?this.radioNewAnswers.push({id:t.id,value:h}):this.radioNewAnswers[c].value=h,this.canvas.discardActiveObject()})}else if("group"===t.type&&t.option){t.selectable=!1,t.lockScalingX=!1,t.evented=!0,t.lockScalingY=!1;const r={id:t.id,value:t.option.slice(2,999),question:t.option.slice(0,2)};this.checkBoxAnswers.push(r),t._objects[1].set("opacity","0");let o={id:t.id,value:"false",question:t.option.slice(0,2)};this.checkBoxNewAnswers.push(o);let h=!1;t.on("mousedown",()=>{h=!h,t._objects[1].set("opacity",h?"1":"0");const s=this.hidden?this.checkBoxNewAnswers:this.checkBoxAnswers,c=s.findIndex(l=>l.id===t.id),d=h?"true":"false";-1!==c?s[c].value=d:s.push({id:t.id,value:d,question:t.option.slice(0,2)})})}else if(t&&"path"===t.type&&"image_svg"===t.id||t&&"group"===t.type&&"image_svg"===t.id);else if(t&&"textbox"===t.type&&"dropdownOptions"===t.id.id){let r=t.text,o={id:t.id.unique,answer:r?.split(")")[0]};t.set({text:r?.split(")")[1]}),this.dropdownAnswers.push(o),this.dropdownArray.push(t),t.visible=!1,t.set("backgroundColor","#fff"),t.on("mousedown",h=>{const s=t.id.unique;this.dropdownArray.forEach(l=>{l.id.unique===s&&(l.set("backgroundColor","#fff"),l.set("fill","#000"))}),t.set("backgroundColor","#000"),t.set("fill","#fff");const c=this.hidden?this.dropdownUser:this.dropdownAnswers,d=c.findIndex(l=>l.id===s);-1!==d?c[d].answer=r?.split(")")[0]:c.push({id:s,answer:r?.split(")")[0]})})}else if(t&&t.id&&"dropdownTitle"===t.id.id){t.evented=!0;let r=!0;t.on("mousedown",o=>{for(let s=0;s<this.dropdownArray.length;s++){let c=this.dropdownArray[s];c.id.unique===t.id.unique&&!0===r?(c.animate("top","+=10",{onChange:this.canvas.renderAll.bind(this.canvas),duration:500,easing:p.fabric.util.ease.easeOutBounce}),c.visible=!0):c.id.unique===t.id.unique&&!1===r&&(c.animate("top","-=10",{onChange:this.canvas.renderAll.bind(this.canvas),duration:500,easing:p.fabric.util.ease.easeOutBounce}),c.visible=!1)}r=!r})}else if(t&&"speak"===t.exercise&&"textbox"===t.type){i=p.fabric.Textbox.prototype._render,p.fabric.Textbox.prototype._render=function(h){if(i.call(this,h),!this.active&&this.showTextBoxBorder){var s=this.width,c=this.height,d=-this.width/2,l=-this.height/2;h.beginPath(),h.moveTo(d,l),h.lineTo(d+s,l),h.lineTo(d+s,l+c),h.lineTo(d,l+c),h.lineTo(d,l),h.closePath();var w=h.strokeStyle;h.strokeStyle=this.textboxBorderColor,h.stroke(),h.strokeStyle=w}},t.dirty=!0,t.splitByGrapheme=!0,t.borderColor="red",t.editingBorderColor="red",t.padding=2,t.showTextBoxBorder=!0,t.textboxBorderColor="black",this.activeMic=t.id;const o=t.text.includes(")")?{id:t?.id,question:t?.text?.split(")")[0],value:t?.text?.split(")")[1]}:{id:null,value:""};this.answers.push(o),t.text=this.transcription,t.width=t.width+100}else t&&"speak"===t.exercise&&"group"===t.type?(this.isBlinking=!1,this.activeMicIcon=t.id,t.on("mousedown",()=>{this.startRecording();let r=!1;this.blinkInterval=setInterval(()=>{t._objects.forEach(o=>{o.set("fill",r?"black":"red")}),this.canvas.renderAll(),r=!r},500)})):t&&"textbox"===t.type&&"listen"===t.exercise&&(t.listen=t.text,t.text="",t.on("mousedown",()=>{let r=!1;if(r)this.stopRecording();else{this.sendTextoSpeechRequest(t.listen,t.language_Code,t.currentStandards);let o=!1;const h=setInterval(()=>{Array.isArray(t._objects)&&t._objects.forEach(s=>{s.set("fill",o?"black":"red")}),this.canvas.renderAll(),o=!o},500);r=!0,t.on("mousedown",()=>{clearInterval(h),Array.isArray(t._objects)&&t._objects.forEach(s=>{s?.set("fill","black")}),this.canvas.renderAll(),r=!1})}}));else{t.hoverCursor="pointer",t.selectable=!0,t.evented=!0,t.editable=!1,t.overflow="hidden",t.lockMovementY=!0,t.lockMovementX=!0,t.lockUniScaling=!0,t.borderColor="black",t.borderWidth=2,t.hasBorders=!1;const r={id:t.id,value:t.option.slice(2,999),question:t.option.slice(0,2)};this.correctOptions.push(r),t.set("backgroundColor","transparent"),t.on("mousedown",s=>{const c=!s.target.isChecked||!1;s.target.isChecked=c,s.target.set("backgroundColor",c?"rgba(0, 0, 255, 0.5)":"transparent");const l=this.hidden?this.userOptions:this.correctOptions,w=s.target.option.slice(0,2),f=l.findIndex(x=>x.id===t.id),m=c?"true":void 0;-1===f&&void 0!==m?l.push({id:s.target.id,value:m,question:w}):-1!==f&&void 0!==m?l[f].value=m:-1!==f&&l.splice(f,1),this.canvas.discardActiveObject()})}else{t.hoverCursor="text",t.selectable=!0,t.editable=!0,t.overflow="hidden",t.lockMovementY=!0,t.lockMovementX=!0,t.lockUniScaling=!0,t.borderColor="black",t.borderWidth=1,t.hasBorders=!1;var i=p.fabric.Textbox.prototype._render;p.fabric.Textbox.prototype._render=function(o){if(i.call(this,o),!this.active&&this.showTextBoxBorder){var h=this.width,s=this.height,c=-this.width/2,d=-this.height/2;o.beginPath(),o.moveTo(c,d),o.lineTo(c+h,d),o.lineTo(c+h,d+s),o.lineTo(c,d+s),o.lineTo(c,d),o.closePath();var l=o.strokeStyle;o.strokeStyle=this.textboxBorderColor,o.stroke(),o.strokeStyle=l}},t.splitByGrapheme=!0,t.borderColor="red",t.editingBorderColor="black",t.showTextBoxBorder=!0,t.textboxBorderColor="black";const r=t.text.includes(")")?{id:t?.id,question:t?.text?.split(")")[0],value:t?.text?.split(")")[1]}:{id:null,value:""};this.answers.push(r),t.set("text",""),t.on("mousedown",o=>{o.target&&"textbox"===o.target.type&&o.target.enterEditing(),t.on("selected",function(h){this.canvas.renderAll()}),t.on("editing:entered",function(h){s.set("fontSize",s.fontSize);var s=this.canvas.getActiveObject();"Enter Text"==s.text&&(s.selectAll(),s.removeChars())}),t.on("editing:exited",()=>{t.set("fontSize",t.fontSize);const h={id:t.id,value:t.text},s=this.newanswers.findIndex(c=>c.id===t.id);-1!==s?this.newanswers[s]=h:this.newanswers.push(h),this.newanswers.push(h)}),t.on("changed",function(){t.set("fontSize",t.fontSize),this.canvas.getActiveObject(),this.canvas.renderAll()}),t.on("modified",function(){this.canvas.renderAll()})}),this.canvas.discardActiveObject()}else{t.selectable=!0,t.editable=!1,t.bringToFront(),this.dragAndDropObjects.push({id:t.id,text:t.text,obj:t});const o=t.left,h=t.top;t.on("modified",()=>{this.dragAndDropAreas.some(c=>{const d=c.obj.getBoundingRect(),l=t.getBoundingRect();return l.left>=d.left&&l.top>=d.top&&l.left+l.width<=d.left+d.width&&l.top+l.height<=d.top+d.height})||(t.animate("left",o,{duration:200,onChange:()=>{this.canvas.renderAll()}}),t.animate("top",h,{duration:200,onChange:()=>{this.canvas.renderAll()}}))})}else{t.selectable=!0,t.editable=!1,t.bringToFront(),this.dragAndDropObjects.push({id:t.id,text:t.text,obj:t});const o=t.left,h=t.top;t.on("modified",()=>{this.dragAndDropAreas.some(c=>{const d=c.obj.getBoundingRect(),l=t.getBoundingRect();return l.left>=d.left&&l.top>=d.top&&l.left+l.width<=d.left+d.width&&l.top+l.height<=d.top+d.height})||(t.animate("left",o,{duration:200,onChange:()=>{this.canvas.renderAll()}}),t.animate("top",h,{duration:200,onChange:()=>{this.canvas.renderAll()}}))})}}),this.canvas.renderAll()})}startRecording(){this.isRecording||(this.isRecording=!0,this.isSilenceLogged=!1,this.audioRecordingService.startRecording(),this.startSilenceDetection())}startSilenceDetection(){this.silenceInterval=setInterval(()=>{0===this.recordedChunks.length?this.isSilenceLogged||(console.log("User stopped speaking"),this.isSilenceLogged=!0,this.stopSilenceDetection(),this.stopRecording()):this.isSilenceLogged=!1},this.silenceDuration)}stopSilenceDetection(){if(this.silenceInterval){clearInterval(this.silenceInterval),clearInterval(this.blinkInterval),this.silenceInterval=null,this.blinkInterval=null;const e=this.canvas.getObjects().find(t=>t.id===this.activeMicIcon);console.log(e?._objects),e?._objects?.forEach(t=>{t?.set("fill","#000")})}}stopRecording(){this.isRecording&&(this.audioRecordingService.stopRecording(),this.isRecording=!1,this.audioRecordingService.getRecordedBlob().subscribe(n=>{const e=new FileReader;e.onloadend=()=>{const t=e.result.toString()?.split(",")[1];this.sendSpeechToTextRequest(t)},e.readAsDataURL(n.blob)}))}clearRecordedData(){this.blobUrl=null}abortRecording(){this.isRecording&&(this.isRecording=!1,this.audioRecordingService.abortRecording())}ngOnDestroy(){this.abortRecording()}sendTextoSpeechRequest(n,e,t){this.http.post("https://us-central1-texttospeech.googleapis.com/v1beta1/text:synthesize?key="+S.N.google_api_key,{audioConfig:{audioEncoding:"LINEAR16",effectsProfileId:["small-bluetooth-speaker-class-device"],pitch:0,speakingRate:1},input:{text:n},voice:{languageCode:e,name:t}},{headers:{"Content-Type":"application/json"}}).subscribe(s=>{if(s&&s.audioContent){const d=atob(s.audioContent),l=new ArrayBuffer(d.length),w=new Uint8Array(l);for(let f=0;f<d.length;f++)w[f]=d.charCodeAt(f);this.playAudio(w)}else console.log("No speech recognition results found.")},s=>{console.error("Speech-to-Text API request error:",s.message)})}sendSpeechToTextRequest(n){var e=new Headers;e.append("Content-Type","application/json");var t=JSON.stringify({audio:{content:n},config:{encoding:"LINEAR16",language_code:"en-US",audioChannelCount:1}});fetch(`https://speech.googleapis.com/v1p1beta1/speech:recognize?key=${S.N.google_api_key}`,{method:"POST",headers:e,body:t,redirect:"follow"}).then(r=>r.json()).then(r=>{this.transcription=r?.results[0]?.alternatives[0]?.transcript;let h=this.canvas.getObjects().find(d=>d.id===this.activeMic);h.set("text",r?.results[0]?.alternatives[0]?.transcript);const s={id:h.id,value:this.transcription},c=this.newanswers.findIndex(d=>d.id===h.id);-1!==c?this.newanswers[c]=s:this.newanswers.push(s),this.canvas.renderAll()}).catch(r=>{this.transcription="try again",this.canvas.renderAll()})}attemptWorksheet(){console.log(this.correctOptions,this.userOptions),this.result=0,this.answerResult=0,this.checkboxResult=0,this.optionsResult=0,this.radioResult=0,this.dragAndDropResult=0,this.arrowResult=0,this.dropdownResult=0,this.canvas.discardActiveObject().renderAll(),this.checkBoxAnswers.length&&(this.checkboxResultCheck(),this.checkboxBackgroundChange()),this.radioAnswers.length&&(this.radioResultCheck(),this.radioBackgroundChange()),this.dragAndDropAreas.length&&(this.dragnDropResultCheck(),this.dragndropBackgroundChange()),this.answers.length&&(this.textboxResultCheck(),this.answersBackgroundChange()),this.correctOptions.length&&(this.mcqsResultCheck(),this.optionsBackgroundChange()),this.qArrows.length&&(this.arrowMatchResultCheck(),this.matchingArrowsBackgroundChange()),this.dropdownAnswers.length&&this.dropdownResultCheck(),this.wordSearchWords.length&&(this.wordSearchCheck(),this.wordSearchBackgroundChange()),this.total(),this.canvas.renderAll()}wordSearchCheck(){let n=0;for(const e of this.wordSearchWords){const t=e.word;let i=!0;for(const r of t){const o=this.searchUserLetter.find(s=>s.letter===r);if(!o){i=!1;break}const h=this.searchUserLetter.findIndex(s=>s.letter===o.letter);o&&(this.searchUserLetter[h].result=!0)}i&&n++}this.wordSearchResult=n}mcqsResultCheck(){let n={};for(let i=0;i<this.correctOptions.length;i++){const r=this.correctOptions[i].value.trim().toLowerCase();let o=!1;for(let c=0;c<this.userOptions.length;c++){const d=this.userOptions[c];if(d&&this.correctOptions[i].id===d.id){const l=d.value?d.value.trim().toLowerCase():"false";r===l?(this.correctOptions[i].result="true",o=!0):this.correctOptions[i].result="false"===r&&"true"===l||"true"===r&&"false"===l?"false":""}}let h=this.correctOptions[i].question,s=this.correctOptions[i].result;n[h]||(n[h]=[]),n[h].push(s)}const e={};for(let i=0;i<this.correctOptions.length;i++){const r=this.correctOptions[i],o=r.question;e[o]||(e[o]={totalOptions:0,trueOptions:0}),e[o].totalOptions++,("true"===r.value&&"true"===r.result||"false"===r.value&&"false"!==r.result)&&e[o].trueOptions++}for(const i in e){const{totalOptions:r,trueOptions:o}=e[i];if(r>0&&r===o){if(this.correctOptions.some(h=>h.question===i&&"false"===h.value&&"false"===h.result))continue;this.optionsResult++}}}radioResultCheck(){let n={};for(let i=0;i<this.radioAnswers.length;i++){const r=this.radioAnswers[i].value.trim().toLowerCase();let o=!1;for(let c=0;c<this.radioNewAnswers.length;c++){const d=this.radioNewAnswers[c];if(d&&this.radioAnswers[i].id===d.id){const l=d.value?d.value.trim().toLowerCase():"false";r===l?(this.radioAnswers[i].result="true",o=!0):this.radioAnswers[i].result="false"===r&&"true"===l||"true"===r&&"false"===l?"false":""}}let h=this.radioAnswers[i].question,s=this.radioAnswers[i].result;n[h]||(n[h]=[]),n[h].push(s)}const e={};for(let i=0;i<this.radioAnswers.length;i++){const r=this.radioAnswers[i],o=r.question;e[o]||(e[o]={totalOptions:0,trueOptions:0}),e[o].totalOptions++,("true"===r.value&&"true"===r.result||"false"===r.value&&"false"!==r.result)&&e[o].trueOptions++}for(const i in e){const{totalOptions:r,trueOptions:o}=e[i];if(r>0&&r===o){if(this.radioAnswers.some(h=>h.question===i&&"false"===h.value&&"false"===h.result))continue;this.radioResult++}}}textboxResultCheck(){let n=[],e={};for(let t=0;t<this.answers.length;t++){const i=this.answers[t].value.trim().toLowerCase();let r=!1;for(let s=0;s<this.newanswers.length;s++){const c=this.newanswers[s]?this.newanswers[s].value.trim().toLowerCase():"";if(this.answers[t].id===this.newanswers[s].id&&i===c){this.answers[t].result=!0,n.push(this.answers[t]),r=!0;break}if(this.answers[t].id===this.newanswers[s].id&&i!==c){this.answers[t].result=!1,n.push(this.answers[t]),r=!1;break}}let o=this.answers[t].question,h=this.answers[t].result;e[o]=e[o]?!0===e[o]&&!0===h:h}for(let t in e)e.hasOwnProperty(t)&&!0===e[t]&&this.answerResult++}dropdownResultCheck(){for(let n=0;n<this.dropdownAnswers.length;n++){const e=this.dropdownAnswers[n].answer.trim().toLowerCase(),t=this.dropdownAnswers[n].id;let i=!1;for(let r=0;r<this.dropdownUser.length;r++){const o=this.dropdownUser[r].answer.trim().toLowerCase();if(t===this.dropdownUser[r].id){e===o&&"true"===e&&(this.dropdownAnswers[n].result=!0,this.dropdownResult+=1),i=!0;break}}i||(this.dropdownAnswers[n].result=!1)}}arrowMatchResultCheck(){let n=[];for(const e of this.lineArrows){const t=this.qArrows.findIndex(i=>e.line.x1>=i.left&&e.line.x1<=i.right&&e.line.y1>=i.top&&e.line.y1<=i.bottom);if(-1!==t){const i=this.qArrows[t],r=this.aArrows.find(o=>e.line.x2>=o.left&&e.line.x2<=o.right&&e.line.y2>=o.top&&e.line.y2<=o.bottom);i&&r&&(n.includes(i.id)?console.log("No match found"):i.id===r.id?(this.qArrows[t].result=!0,this.arrowResult++,n.push(i.id)):this.qArrows[t].result=!1)}}}dragnDropResultCheck(){for(const n of this.dragAndDropObjects){const e=n.obj,t=this.dragAndDropAreas.findIndex(i=>i.text===n.text&&(i.id!==n.id||i.id===n.id));if(-1!==t){const i=this.dragAndDropAreas[t];e.left>=i.obj.left&&e.top>=i.obj.top&&e.top+e.height*e.scaleY<=i.obj.top+i.obj.height*i.obj.scaleY&&e.left+e.width*e.scaleX<=i.obj.left+i.obj.width*i.obj.scaleX?(this.dragAndDropResult++,this.dragAndDropAreas[t].result=!0):(console.log("The textbox is not inside the rectangle."),this.dragAndDropAreas[t].result=!1)}else console.log("Could not find drag and drop area.")}}checkboxResultCheck(){let n=[];for(let i=0;i<this.checkBoxAnswers.length;i++){const r=this.checkBoxAnswers[i].value;let o=!1;for(let h=0;h<this.checkBoxNewAnswers.length;h++)if(this.checkBoxAnswers[i].id===this.checkBoxNewAnswers[h].id&&r===(this.checkBoxNewAnswers[h]?this.checkBoxNewAnswers[h].value:"")){this.checkBoxAnswers[i].result=!0,o=!0;break}o||(this.checkBoxAnswers[i].result=!1),n.push(this.checkBoxAnswers[i])}let e={};for(let i=0;i<n.length;i++){let r=n[i],o=r.question,h=r.result,s=r.id;e[o]||(e[o]={}),e[o][s]||(e[o][s]={totalOptions:0,trueOptions:0}),e[o][s].totalOptions++,!0===h&&e[o][s].trueOptions++}let t=!0;for(let i in e)if(!Object.values(e[i]).some(h=>h.trueOptions>0)){t=!1;break}for(let i in e)Object.values(e[i]).every(h=>h.totalOptions===h.trueOptions)&&t&&this.checkboxResult++}matchingArrowsBackgroundChange(){let n=[],e=[];const t=this.canvas.getObjects();for(let i=0;i<this.qArrows.length;i++){const r=this.qArrows[i],o=t.filter(h=>h.id===r.id&&!1===r.result);n=n.concat(o)}for(let i=0;i<this.qArrows.length;i++){const r=this.qArrows[i],o=t.filter(h=>h.id===r.id&&!0===r.result);e=e.concat(o)}n.forEach(i=>{i.set({backgroundColor:"rgba(255,0,0,0.7)"})}),e.forEach(i=>{i.set({backgroundColor:"rgba(0,255,0,0.7)"})})}dragndropBackgroundChange(){let n=[],e=[];const t=this.canvas.getObjects();for(let i=0;i<this.dragAndDropAreas.length;i++){const r=this.dragAndDropAreas[i],o=t.filter(s=>s.id===r.id&&!0!==r.result),h=t.filter(s=>s.id===r.id&&!0===r.result);n=n.concat(o),e=n.concat(h)}n.forEach(i=>{i.set({backgroundColor:"rgba(255,0,0,0.7)"})})}answersBackgroundChange(){let n=[];const e=this.canvas.getObjects();for(let t=0;t<this.answers.length;t++){const i=this.answers[t],r=e.filter(o=>o.id===i.id&&!0!==i.result);n=n.concat(r)}n.forEach(t=>{t.set({backgroundColor:"rgba(255,0,0,0.7)"})})}wordSearchBackgroundChange(){let n=[],e=[];const t=this.canvas.getObjects();for(let i=0;i<this.searchUserLetter.length;i++){const r=this.searchUserLetter[i],o=t.filter(h=>h.id===r.letter&&!0===r.result);n=n.concat(o)}for(let i=0;i<this.searchUserLetter.length;i++){const r=this.searchUserLetter[i],o=t.filter(h=>h.id===r.letter&&!r.result);e=e.concat(o)}n.forEach(i=>{i.set({fill:"rgba(0, 255, 0, 0.7)"})}),e.forEach(i=>{i.set({fill:"rgba(255, 0, 0, 0.7)"})}),this.canvas.renderAll()}radioBackgroundChange(){let n=[];const e=this.canvas.getObjects();for(let t=0;t<this.radioAnswers.length;t++){const i=this.radioAnswers[t],r=e.filter(o=>o.id===i.id&&("false"===i.result||"true"===i.result));n=n.concat(r)}n.forEach(t=>{"false"===t.option?.split(")")[1]?t.set({fill:"rgba(255,0,0,0.7)"}):"true"===t.option?.split(")")[1]&&t.set({fill:"rgba(0,255,0,0.7)"})})}optionsBackgroundChange(){let n=[];const e=this.canvas.getObjects();for(let t=0;t<this.correctOptions.length;t++){const i=this.correctOptions[t],r=e.filter(o=>o.id===i.id&&("false"===i.result||"true"===i.result));n=n.concat(r)}n.forEach(t=>{"false"===t.option?.split(")")[1]?t.set({backgroundColor:"rgba(255,0,0,0.7)"}):"true"===t.option?.split(")")[1]&&t.set({backgroundColor:"rgba(0,255,0,0.7)"})})}checkboxBackgroundChange(){let n=[];const e=this.canvas.getObjects();for(let t=0;t<this.checkBoxAnswers.length;t++){const i=this.checkBoxAnswers[t],r=e.filter(o=>o.id===i.id&&(!1===i.result||!0===i.result));n=n.concat(r)}n.forEach(t=>{"false"===t.option?.split(")")[1]?t._objects[1].set({fill:"rgba(255,0,0,0.7)"}):"true"===t.option?.split(")")[1]&&t._objects[1].set({fill:"rgba(0,255,0,0.7)"})})}total(){this.result=this.answerResult+this.checkboxResult+this.optionsResult+this.radioResult+this.dragAndDropResult+this.arrowResult+this.dropdownResult+this.wordSearchResult,this.hidden=!1;for(let d in this.radioAnswers)this.radioAnswers&&"true"===this.radioAnswers[d].value&&this.radioQuestions++;let n=[];for(let d of this.correctOptions)"true"===d.value&&(n.includes(d.question)||n.push(d.question));this.mcQuestions=n.length;const t=new Set;for(const d of this.checkBoxAnswers)t.has(d.question)||t.add(d.question);this.checkBoxQuestions=t.size;let i=0;for(let d=0;d<this.dropdownAnswers.length;d++)"true"===this.dropdownAnswers[d].answer&&i++;let r={};for(let d=0;d<this.answers.length;d++){let l=this.answers[d],w=l.question;l.question&&(r[w]||(r[w]=!0,this.textboxQuestions++))}const h=new p.fabric.Textbox(`${this.result}/${this.checkBoxQuestions+this.textboxQuestions+this.mcQuestions+this.radioQuestions+this.dragAndDropAreas.length+this.qArrows.length+i+this.wordSearchWords.length}`,{left:120,top:150,fontSize:100,angle:0,fill:"red",fontFamily:"BrushScriptMT",borderColor:"black",originX:"center",originY:"center",padding:2}),s=new p.fabric.Circle({radius:100,left:120,top:150,fill:"transparent",stroke:"red",strokeWidth:4,originX:"center",originY:"center"}),c=new p.fabric.Group([s,h],{selectable:!1,editable:!1});this.canvas.add(c),this.canvas.renderAll()}retake(){location.reload(),this.result=0,this.answerResult=0,this.checkboxResult=0,this.radioResult=0,window.location.href=`#/worksheet-details/${this.sheetDetails._id}`}rasterize(){const n=new Image;this.canvas.forEachObject(t=>{"image"===t.type&&t.src&&t.src.startsWith("http")&&this.canvas.remove(t)}),n.crossOrigin="anonymous",n.src=this.canvas.toDataURL({format:"png"}),window.open("").document.write(n.outerHTML),this.downLoadImage()}downLoadImage(){const n=this.canvas.toDataURL({format:"png"}),e=document.createElement("a");document.body.appendChild(e),e.href=n,e.target="_self",e.download=Date.now()+".png",e.click()}downloadDataURL(n,e){const t=document.createElement("a");t.href=n,t.download=e,t.click()}rasterizeSVG(){return window.open("").document.write(this.canvas.toSVG()),this.downLoadSVG(),"data:image/svg+xml;utf8,"+encodeURIComponent(this.canvas.toSVG())}downLoadSVG(){const n="data:image/svg+xml;utf8,"+encodeURIComponent(this.canvas.toSVG()),e=document.createElement("a");document.body.appendChild(e),e.href=n,e.target="_self",e.download=Date.now()+".svg",e.click()}updateWorksheet(){this.router.navigate(["/updateworksheet",this.sheetDetails._id])}getSafeUrl(n){return this.sanitizer.bypassSecurityTrustResourceUrl(n)}showBasicDialog2(n){if(this.displayBasic2=!0,this.urls=n,this.urls.includes("youtube.com")){const t=new URL(this.urls).searchParams.get("v");this.safeurls=this.sanitizer.bypassSecurityTrustResourceUrl(`https://www.youtube.com/embed/${t}`)}}resetUrls(){this.urls="",this.safeurls=""}deleteWorksheet(){window.confirm("Are you sure you want to delete this item?")&&this.userService.deleteSheet(this.sheetDetails._id)}}return u.\u0275fac=function(n){return new(n||u)(a.Y36(W.gz),a.Y36(W.F0),a.Y36(H.eN),a.Y36(T.K),a.Y36(L.H7),a.Y36(O))},u.\u0275cmp=a.Xpm({type:u,selectors:[["app-view-livesheet"]],hostBindings:function(n,e){1&n&&a.NdJ("resize",function(i){return e.onResize(i)},!1,a.Jf7)},features:[a._Bn([O])],decls:12,vars:7,consts:[["claas","grid"],[1,"grid","col-12","flex-column","justify-content-center","align-items-center"],["id","canvas",1,""],["htmlCanvas",""],[1,"col-12","flex","flex-wrap","justify-content-center","align-items-center","mx-auto"],["pButton","","label","Finish","icon","pi pi-save","type","button","class","p-2 text-xs border-0",3,"click",4,"ngIf"],["pButton","","label","Retake","icon","pi pi-replay","type","button","class","p-2 text-xs border-0",3,"click",4,"ngIf"],["header","Worksheet details",3,"visible","visibleChange","onHide"],[4,"ngIf"],["pButton","","label","Finish","icon","pi pi-save","type","button",1,"p-2","text-xs","border-0",3,"click"],["pButton","","label","Retake","icon","pi pi-replay","type","button",1,"p-2","text-xs","border-0",3,"click"],["id","myVideo","width","100%","height","100%","controls","","autoplay",""],["type","video/mp4",3,"src"],["id","myAudio","width","auto","height","100%","controls","","autoplay",""],["type","audio/mpeg",3,"src"],["width","560","height","315","title","YouTube video player","frameborder","0","allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share","allowfullscreen","",3,"src"]],template:function(n,e){1&n&&(a.TgZ(0,"div",0)(1,"div",1),a._UZ(2,"canvas",2,3),a.TgZ(4,"div",4),a.YNc(5,D,1,0,"button",5),a.YNc(6,U,1,0,"button",6),a.qZA()()(),a.TgZ(7,"p-dialog",7),a.NdJ("visibleChange",function(i){return e.displayBasic2=i})("onHide",function(){return e.resetUrls()}),a.YNc(8,N,4,1,"div",8),a.YNc(9,_,4,1,"div",8),a.YNc(10,M,4,1,"div",8),a.YNc(11,b,2,1,"div",8),a.qZA()),2&n&&(a.xp6(5),a.Q6J("ngIf",e.hidden),a.xp6(1),a.Q6J("ngIf",!e.hidden),a.xp6(1),a.Q6J("visible",e.displayBasic2),a.xp6(1),a.Q6J("ngIf",e.urls&&e.urls.trim()&&e.urls.endsWith(".mp4")),a.xp6(1),a.Q6J("ngIf",e.urls&&e.urls.trim()&&e.urls.endsWith(".mp3")),a.xp6(1),a.Q6J("ngIf",e.urls&&e.urls.trim()&&e.urls.endsWith(".m4a")),a.xp6(1),a.Q6J("ngIf",e.urls&&e.urls.trim()&&!e.urls.endsWith(".mp4")&&!e.urls.endsWith(".mp3")&&!e.urls.endsWith(".m4a")&&e.urls.includes("youtube.com")))},dependencies:[Z.O5,q.Hq,I.V]}),u})()}];let V=(()=>{class u{}return u.\u0275fac=function(n){return new(n||u)},u.\u0275mod=a.oAB({type:u}),u.\u0275inj=a.cJS({imports:[W.Bz.forChild(z),W.Bz]}),u})()}}]);
"use strict";(self.webpackChunkmyapp=self.webpackChunkmyapp||[]).push([[128],{2128:(J,R,g)=>{g.r(R),g.d(R,{WorksheetDetailRoutingModule:()=>F});var W=g(9965),v=g(8621),B=g(5108),A=g(5439),k=g(7579),h=g(8256);let O=(()=>{class c{constructor(){this._recorded=new k.x,this._recordingTime=new k.x,this._recordingFailed=new k.x}getRecordedBlob(){return this._recorded.asObservable()}getRecordedTime(){return this._recordingTime.asObservable()}recordingFailed(){return this._recordingFailed.asObservable()}startRecording(){this.recorder||(this._recordingTime.next("00:00"),navigator.mediaDevices.getUserMedia({audio:{channelCount:1}}).then(t=>{this.stream=t,this.record()}).catch(t=>{this._recordingFailed.next("k")}))}abortRecording(){this.stopMedia()}record(){this.recorder=new B.StereoAudioRecorder(this.stream,{type:"audio",mimeType:"audio/wav",numberOfAudioChannels:1}),this.recorder.record(),this.startTime=A(),this.interval=setInterval(()=>{const i=A(),t=A.duration(i.diff(this.startTime)),r=this.toString(t.minutes())+":"+this.toString(t.seconds());this._recordingTime.next(r)},1e3)}toString(i){let t=i;return i||(t="00"),i<10&&(t="0"+i),t}stopRecording(){this.recorder&&this.recorder.stop(i=>{if(this.startTime){const t=encodeURIComponent("audio_"+(new Date).getTime()+".mp3");this.stopMedia(),this._recorded.next({blob:i,title:t})}},()=>{this.stopMedia(),this._recordingFailed.next("h")})}stopMedia(){this.recorder&&(this.recorder=null,clearInterval(this.interval),this.startTime=null,this.stream&&(this.stream.getAudioTracks().forEach(i=>i.stop()),this.stream=null))}}return c.\u0275fac=function(i){return new(i||c)},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac}),c})();var S=g(2340),T=g(529),D=g(4981),H=g(1481),Z=g(6895),q=g(5593),I=g(1493);function _(c,p){if(1&c){const i=h.EpF();h.TgZ(0,"button",11),h.NdJ("click",function(){h.CHM(i);const r=h.oxw();return h.KtG(r.updateWorksheet())}),h.qZA()}}function L(c,p){if(1&c){const i=h.EpF();h.TgZ(0,"button",12),h.NdJ("click",function(){h.CHM(i);const r=h.oxw();return h.KtG(r.deleteWorksheet())}),h.qZA()}}function b(c,p){if(1&c){const i=h.EpF();h.TgZ(0,"button",13),h.NdJ("click",function(){h.CHM(i);const r=h.oxw();return h.KtG(r.attemptWorksheet())}),h.qZA()}}function U(c,p){if(1&c){const i=h.EpF();h.TgZ(0,"button",14),h.NdJ("click",function(){h.CHM(i);const r=h.oxw();return h.KtG(r.retake())}),h.qZA()}}function N(c,p){if(1&c&&(h.TgZ(0,"div")(1,"video",15),h._UZ(2,"source",16),h._uU(3," Your browser does not support HTML5 video. "),h.qZA()()),2&c){const i=h.oxw();h.xp6(2),h.Q6J("src",i.urls,h.LSH)}}function M(c,p){if(1&c&&(h.TgZ(0,"div")(1,"audio",17),h._UZ(2,"source",18),h._uU(3," Your browser does not support HTML5 audio. "),h.qZA()()),2&c){const i=h.oxw();h.xp6(2),h.Q6J("src",i.urls,h.LSH)}}function z(c,p){if(1&c&&(h.TgZ(0,"div")(1,"audio",17),h._UZ(2,"source",18),h._uU(3," Your browser does not support HTML5 audio. "),h.qZA()()),2&c){const i=h.oxw();h.xp6(2),h.Q6J("src",i.urls,h.LSH)}}function Y(c,p){if(1&c&&(h.TgZ(0,"div"),h._UZ(1,"iframe",19),h.qZA()),2&c){const i=h.oxw();h.xp6(1),h.Q6J("src",i.safeurls,h.uOi)}}const E=[{path:"",component:(()=>{class c{constructor(i,t,r,e,n,o){this.route=i,this.router=t,this.http=r,this.userService=e,this.sanitizer=n,this.audioRecordingService=o,this.title="Attempt Worksheet",this.data="",this.answers=[],this.newanswers=[],this.correctOptions=[],this.userOptions=[],this.checkBoxAnswers=[],this.checkBoxNewAnswers=[],this.radioAnswers=[],this.radioNewAnswers=[],this.dragAndDropAreas=[],this.dragAndDropObjects=[],this.dropdownArray=[],this.qArrows=[],this.aArrows=[],this.lineArrows=[],this.dropdownUser=[],this.dropdownAnswers=[],this.wordSearchWords=[],this.searchCorrectLetter=[],this.searchUserLetter=[],this.hidden=!0,this.isDrawing=!1,this.isAdmin=!1,this.isLoggedIn=!1,this.isDrawLine=!1,this.lineDrawn=!1,this.answerResult=0,this.checkboxResult=0,this.radioResult=0,this.optionsResult=0,this.wordSearchResult=0,this.dragAndDropResult=0,this.arrowResult=0,this.dropdownResult=0,this.result=0,this.checkBoxQuestions=0,this.radioQuestions=0,this.mcQuestions=0,this.textboxQuestions=0,this.displayBasic2=!1,this.isBlinking=!1,this.isPlaying=!1,this.transcription="speak...",this.displayControls=!0,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.isRecording=!1,this.canvasHeight=1e3,this.canvasWidth=700,this.isSilenceLogged=!1,this.recordedChunks=[],this.silenceThreshold=100,this.silenceDuration=3e3,this.updateCanvasSize=()=>{const s=JSON.parse(this.json).objects.find(d=>"size"===d.id);console.log("sizer",s.height),s.height>=1e3?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.3),this.canvas.setWidth(650),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.16),this.canvas.setZoom(.85),this.canvas.setWidth(600)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.3),this.canvas.setWidth(540)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.4),this.canvas.setWidth(500)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.55),this.canvas.setWidth(450)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.78),this.canvas.setWidth(400)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.95),this.canvas.setWidth(365)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.18),this.canvas.setWidth(320)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.38),this.canvas.setWidth(270),this.canvas.setHeight(s.height/2.6)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(220),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.22),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.4)):s.height<1e3&&s.height>=900?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.1),this.canvas.setWidth(650),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.18),this.canvas.setZoom(.85),this.canvas.setWidth(600)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.34),this.canvas.setWidth(540)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.43),this.canvas.setWidth(500)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.58),this.canvas.setWidth(450)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.81),this.canvas.setWidth(400)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.98),this.canvas.setWidth(365)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.21),this.canvas.setWidth(320)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.38),this.canvas.setWidth(270),this.canvas.setHeight(s.height/2.6)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(220),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.22),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.2)):s.height<900&&s.height>=800?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.11),this.canvas.setWidth(650),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.16),this.canvas.setZoom(.85),this.canvas.setWidth(590)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.31),this.canvas.setWidth(520)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.41),this.canvas.setWidth(490)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.58),this.canvas.setWidth(440)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.81),this.canvas.setWidth(380)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.98),this.canvas.setWidth(350)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.21),this.canvas.setWidth(310)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.38),this.canvas.setWidth(260),this.canvas.setHeight(s.height/2.6)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(215),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.22),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.2)):s.height<800&&s.height>=500?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.11),this.canvas.setWidth(640),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.2),this.canvas.setZoom(.85),this.canvas.setWidth(590)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.35),this.canvas.setWidth(520)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.45),this.canvas.setWidth(490)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.62),this.canvas.setWidth(440)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.84),this.canvas.setWidth(380)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/2.05),this.canvas.setWidth(350)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.26),this.canvas.setWidth(310)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.37),this.canvas.setWidth(260),this.canvas.setHeight(s.height/2.7)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(215),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.21),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.5)):s.height<600&&s.height>=400?this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.105),this.canvas.setWidth(640),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.15),this.canvas.setZoom(.85),this.canvas.setWidth(590)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.3),this.canvas.setWidth(520)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.4),this.canvas.setWidth(490)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.55),this.canvas.setWidth(440)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.8),this.canvas.setWidth(380)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.9),this.canvas.setWidth(350)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.24),this.canvas.setWidth(320)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.37),this.canvas.setWidth(260),this.canvas.setHeight(s.height/2.7)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(215),this.canvas.setHeight(s.height/3.2)):this.windowWidth<250&&(this.canvas.setZoom(.21),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.5)):s.height<600&&s.height>=300&&(this.windowWidth<750&&this.windowWidth>=700?(this.canvas.setHeight(s.height/1.09),this.canvas.setWidth(640),this.canvas.setZoom(.91)):this.windowWidth<700&&this.windowWidth>=650?(this.canvas.setHeight(s.height/1.15),this.canvas.setZoom(.85),this.canvas.setWidth(590)):this.windowWidth<650&&this.windowWidth>=600?(this.canvas.setZoom(.75),this.canvas.setHeight(s.height/1.3),this.canvas.setWidth(520)):this.windowWidth<600&&this.windowWidth>=550?(this.canvas.setZoom(.7),this.canvas.setHeight(s.height/1.4),this.canvas.setWidth(490)):this.windowWidth<550&&this.windowWidth>=500?(this.canvas.setZoom(.63),this.canvas.setHeight(s.height/1.55),this.canvas.setWidth(440)):this.windowWidth<500&&this.windowWidth>=450?(this.canvas.setZoom(.55),this.canvas.setHeight(s.height/1.8),this.canvas.setWidth(380)):this.windowWidth<450&&this.windowWidth>=400?(this.canvas.setZoom(.5),this.canvas.setHeight(s.height/1.9),this.canvas.setWidth(350)):this.windowWidth<400&&this.windowWidth>=350?(this.canvas.setZoom(.45),this.canvas.setHeight(s.height/2.19),this.canvas.setWidth(320)):this.windowWidth<350&&this.windowWidth>=300?(this.canvas.setZoom(.37),this.canvas.setWidth(260),this.canvas.setHeight(s.height/2.5)):this.windowWidth<300&&this.windowWidth>=250?(this.canvas.setZoom(.31),this.canvas.setWidth(215),this.canvas.setHeight(s.height/3.1)):this.windowWidth<250&&(this.canvas.setZoom(.21),this.canvas.setWidth(150),this.canvas.setHeight(s.height/4.5)))},this.token=localStorage.getItem("token"),this.audioRecordingService.recordingFailed().subscribe(()=>{this.isRecording=!1}),this.audioRecordingService.getRecordedTime().subscribe(a=>{this.recordedTime=a}),this.audioRecordingService.getRecordedBlob().subscribe(a=>{this.blobUrl=this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(a.blob))})}playAudio(i){this.audioContext.decodeAudioData(i.buffer,r=>{this.audioSource=this.audioContext.createBufferSource(),this.audioSource.buffer=r,this.audioSource.connect(this.audioContext.destination),this.audioSource.start(0)})}stopAudio(){this.audioSource&&this.audioSource.stop()}ngOnInit(){this.audioContext=new AudioContext,this.userService.getUserRole().subscribe(t=>{this.myRole=t,this.isLoggedIn=this.token&&("admin"===this.myRole||"user"===this.myRole),this.isAdmin=this.token&&"admin"===this.myRole});const i=this.route.snapshot.paramMap.get("id");this.userService.getOurSheetById(i).subscribe(t=>{this.sheetDetails=t.data,this.json=t.data.content,this.createFabricCanvas(),this.loadFromJson(),this.updateCanvasSize()},t=>{console.error("Failed to retrieve sheet details:",t)})}onResize(i){this.windowWidth=i.target.innerWidth,this.windowHeight=i.target.innerHeight}createFabricCanvas(){this.canvas=new v.fabric.Canvas("canvas")}drawShape(i,t){let r,e;i.off("mouse:down"),i.off("mouse:up");let a=0;i.on("mouse:down",s=>{this.isDrawing=!0;const d=s.target;if(d&&"rect"===d.type&&!0===d.qArrow){d.hoverCursor="pointer";const l=i.getPointer(s.e),u=[l.x,l.y,l.x,l.y],w=this.lineArrows.findIndex(m=>m.textBoxId===d.id);if(w>-1){const m=this.lineArrows[w].line;i.remove(m),i.remove(e),this.lineArrows.splice(w,1),a=m.get("id")}r=new v.fabric.Line(u,{fill:"transparent",stroke:"blue",strokeWidth:3,selectable:!1});let C=Math.atan2(r.y2-r.y1,r.x2-r.x1);C*=180/Math.PI,C+=90,e=new v.fabric.Triangle({angle:C,fill:"blue",selectable:!1,top:r.y2,left:r.x2,width:15,height:15,originX:"center",originY:"center",stroke:"black"}),v.fabric.Group.prototype.toObject=(m=v.fabric.Group.prototype.toObject,function(y){return y=(y||[]).concat(["id"]),m.apply(this,[y])}),r.set("id",a+1),i.add(r),i.add(e),i.renderAll(),this.lineArrows.push({line:r,textBoxId:d.id}),a++}var m}),i.on("mouse:move",s=>{if(this.isDrawing&&"arrow"===t){const d=i.getPointer(s.e);r.set({x2:d.x,y2:d.y});let w=Math.atan2(r.y2-r.y1,r.x2-r.x1);w*=180/Math.PI,w+=90,e.set({top:r.y2,left:r.x2,angle:w,width:15,height:15}),i.renderAll()}}),i.on("mouse:up",s=>{if(this.isDrawing&&"arrow"===t){this.isDrawing=!1;for(const d of this.lineArrows){const l=this.qArrows.findIndex(u=>d.line.x1>=u.left&&d.line.x1<=u.right&&d.line.y1>=u.top&&d.line.y1<=u.bottom);if(-1!==l){const u=this.qArrows[l],w=this.aArrows.find(f=>d.line.x2>=f.left&&d.line.x2<=f.right&&d.line.y2>=f.top&&d.line.y2<=f.bottom);if(!u||!w){this.canvas.remove(d.line),this.canvas.remove(e);const f=this.lineArrows.indexOf(d);this.lineArrows.splice(f,1)}}}r=null}}),this.isDrawing=!1}loadFromJson(){const i=JSON.parse(this.json);i||location.reload(),i&&this.canvas.loadFromJSON(i,()=>{this.canvas.selection=!1,this.canvas.selection=!1,this.canvas.forEachObject(t=>{if(t.hoverCursor="pointer",t.selectable=!1,t.lockScalingX=!0,t.lockScalingY=!0,t.hasControls=!1,"size"===t.id&&(this.windowWidth>750?(this.canvas.setWidth(t.width),this.canvas.setHeight(t.height)):this.updateCanvasSize(),this.canvas.renderAll()),t&&"rect"===t.type&&!0===t.aArrow&&"size"!==t.id&&(t.evented=!0,t.set("fill","transparent"),t.set("stroke","transparent"),this.aArrows.push({id:t.id,left:t.left,top:t.top,right:t.left+t.width*t.scaleX,bottom:t.top+t.height*t.scaleY}),this.canvas.on("mouse:up",n=>{})),t&&"rect"===t.type&&!0===t.qArrow&&"size"!==t.id&&(this.isDrawing=!0,t.evented=!0,t.set("stroke","transparent"),t.set("fill","transparent"),this.qArrows.push({id:t.id,left:t.left,top:t.top,right:t.left+t.width*t.scaleX,bottom:t.top+t.height*t.scaleY}),this.canvas.on("mouse:over",n=>{t.hoverCursor="crosshair",this.lineDrawn=!0}),this.canvas.on("mouse:down",n=>{this.lineDrawn=!0;const o=n.target;o&&"rect"===o.type&&!0===o.qArrow&&"size"!==t.id&&(t.set("fill","transparent"),this.drawShape(this.canvas,"arrow"),this.canvas.renderAll())})),t&&"rect"===t.type&&"mainrect"===t.id&&"size"!==t.id&&(t.on("mouse:over",function(e){e.target.set("hoverCursor","pointer"),this.canvas.renderAll()}),t.searchdata.map(e=>{const n={question:e.word?.split(")")[0],word:e.letters};this.wordSearchWords.push(n)})),t&&"rect"===t.type&&"smallrects"===t.types&&"size"!==t.id)this.searchCorrectLetter.push(t.id),t.set("fill","transparent"),t.on("mousedown",()=>{-1===this.searchUserLetter.findIndex(n=>n.letter===t.id)?this.searchUserLetter.push({letter:t.id}):this.searchUserLetter=this.searchUserLetter.filter(n=>t.id!==n.letter),this.canvas.selection=!1,"transparent"===t.fill?(t.set("value",!0),t.set({fill:"rgba(0, 0, 255, 0.5)"})):(t.set({fill:"transparent"}),t.set("value",!1)),this.canvas.renderAll()});else if(t&&"rect"===t.type&&!0===t.droparea&&"size"!==t.id)this.dragAndDropAreas.push({id:t.id,text:t.text,obj:t});else if(!t||"textbox"!==t.type||!0!==t.dropobject||t.id.id||t.id.unique)if(!t||"image"!==t.type||!0!==t.dropobject||t.id.id||t.id.unique)if("i-text"===t.type&&"link"===t.id&&t.link)t.selectable=!1,t.lockScalingX=!1,t.evented=!0,t.lockScalingY=!1,t.on("mousedown",()=>{window.open(t.link,"_blank")});else if("i-text"===t.type&&"mediaLink"===t.id&&t.link)t.selectable=!1,t.lockScalingX=!1,t.evented=!0,t.lockScalingY=!1,t.on("mousedown",e=>{this.showBasicDialog2(t.link)});else if("textbox"!==t.type||!0!==this.hidden||t.dropobject||t.aArrow||t.qArrow||t.option||t.id.id||t.id.unique||t.exercise)if("textbox"!==t.type||!t.option||t.id.id||t.id.unique)if("circle"===t.type&&!0===this.hidden){t.selectable=!0,t.lockMovementY=!0,t.lockMovementX=!0,t.lockUniScaling=!0,t.editable=!0;const e={id:t.id,value:t.option.slice(2,999),question:t.option.slice(0,2)};this.radioAnswers.push(e),t.set("fill","transparent");let n=!1,o="false";t.on("mousedown",a=>{n=!n,!0===n?t.set("fill","black"):!1===n&&t.set("fill","transparent");const s=this.radioNewAnswers.findIndex(d=>d.id===t.id);o=n?"true":"false",-1===s?this.radioNewAnswers.push({id:t.id,value:o}):this.radioNewAnswers[s].value=o,this.canvas.discardActiveObject()})}else if("group"===t.type&&t.option){t.selectable=!1,t.lockScalingX=!1,t.evented=!0,t.lockScalingY=!1;const e={id:t.id,value:t.option.slice(2,999),question:t.option.slice(0,2)};this.checkBoxAnswers.push(e),t._objects[1].set("opacity","0");let n={id:t.id,value:"false",question:t.option.slice(0,2)};this.checkBoxNewAnswers.push(n);let o=!1;t.on("mousedown",()=>{o=!o,t._objects[1].set("opacity",o?"1":"0");const a=this.hidden?this.checkBoxNewAnswers:this.checkBoxAnswers,s=a.findIndex(l=>l.id===t.id),d=o?"true":"false";-1!==s?a[s].value=d:a.push({id:t.id,value:d,question:t.option.slice(0,2)})})}else if(t&&"path"===t.type&&"image_svg"===t.id||t&&"group"===t.type&&"image_svg"===t.id);else if(t&&"textbox"===t.type&&"dropdownOptions"===t.id.id){let e=t.text,n={id:t.id.unique,answer:e?.split(")")[0]};t.set({text:e?.split(")")[1]}),this.dropdownAnswers.push(n),this.dropdownArray.push(t),t.visible=!1,t.set("backgroundColor","#fff"),t.on("mousedown",o=>{const a=t.id.unique;this.dropdownArray.forEach(l=>{l.id.unique===a&&(l.set("backgroundColor","#fff"),l.set("fill","#000"))}),t.set("backgroundColor","#000"),t.set("fill","#fff");const s=this.hidden?this.dropdownUser:this.dropdownAnswers,d=s.findIndex(l=>l.id===a);-1!==d?s[d].answer=e?.split(")")[0]:s.push({id:a,answer:e?.split(")")[0]})})}else if(t&&t.id&&"dropdownTitle"===t.id.id){t.evented=!0;let e=!0;t.on("mousedown",n=>{for(let a=0;a<this.dropdownArray.length;a++){let s=this.dropdownArray[a];s.id.unique===t.id.unique&&!0===e?(s.animate("top","+=10",{onChange:this.canvas.renderAll.bind(this.canvas),duration:500,easing:v.fabric.util.ease.easeOutBounce}),s.visible=!0):s.id.unique===t.id.unique&&!1===e&&(s.animate("top","-=10",{onChange:this.canvas.renderAll.bind(this.canvas),duration:500,easing:v.fabric.util.ease.easeOutBounce}),s.visible=!1)}e=!e})}else if(t&&"speak"===t.exercise&&"textbox"===t.type){r=v.fabric.Textbox.prototype._render,v.fabric.Textbox.prototype._render=function(o){if(r.call(this,o),!this.active&&this.showTextBoxBorder){var a=this.width,s=this.height,d=-this.width/2,l=-this.height/2;o.beginPath(),o.moveTo(d,l),o.lineTo(d+a,l),o.lineTo(d+a,l+s),o.lineTo(d,l+s),o.lineTo(d,l),o.closePath();var u=o.strokeStyle;o.strokeStyle=this.textboxBorderColor,o.stroke(),o.strokeStyle=u}},t.dirty=!0,t.splitByGrapheme=!0,t.borderColor="red",t.editingBorderColor="red",t.padding=2,t.showTextBoxBorder=!0,t.textboxBorderColor="black",this.activeMic=t.id;const n=t.text.includes(")")?{id:t?.id,question:t?.text?.split(")")[0],value:t?.text?.split(")")[1]}:{id:null,value:""};this.answers.push(n),t.text=this.transcription,t.width=t.width+100}else t&&"speak"===t.exercise&&"group"===t.type?(this.isBlinking=!1,this.activeMicIcon=t.id,t.on("mousedown",()=>{this.startRecording();let e=!1;this.blinkInterval=setInterval(()=>{t._objects.forEach(n=>{n.set("fill",e?"black":"red")}),this.canvas.renderAll(),e=!e},500)})):t&&"textbox"===t.type&&"listen"===t.exercise&&(t.listen=t.text,t.text="",t.on("mousedown",()=>{let e=!1;if(e)this.stopRecording();else{this.sendTextoSpeechRequest(t.listen,t.language_Code,t.currentStandards);let n=!1;const o=setInterval(()=>{Array.isArray(t._objects)&&t._objects.forEach(a=>{a.set("fill",n?"black":"red")}),this.canvas.renderAll(),n=!n},500);e=!0,t.on("mousedown",()=>{clearInterval(o),Array.isArray(t._objects)&&t._objects.forEach(a=>{a?.set("fill","black")}),this.canvas.renderAll(),e=!1})}}));else{t.hoverCursor="pointer",t.selectable=!0,t.evented=!0,t.editable=!1,t.overflow="hidden",t.lockMovementY=!0,t.lockMovementX=!0,t.lockUniScaling=!0,t.borderColor="black",t.borderWidth=2,t.hasBorders=!1;const e={id:t.id,value:t.option.slice(2,999),question:t.option.slice(0,2)};this.correctOptions.push(e),t.set("backgroundColor","transparent"),t.on("mousedown",a=>{const s=!a.target.isChecked||!1;a.target.isChecked=s,a.target.set("backgroundColor",s?"rgba(0, 0, 255, 0.5)":"transparent");const l=this.hidden?this.userOptions:this.correctOptions,u=a.target.option.slice(0,2),w=l.findIndex(x=>x.id===t.id),f=s?"true":void 0;-1===w&&void 0!==f?l.push({id:a.target.id,value:f,question:u}):-1!==w&&void 0!==f?l[w].value=f:-1!==w&&l.splice(w,1),this.canvas.discardActiveObject()})}else{t.hoverCursor="text",t.selectable=!0,t.editable=!0,t.overflow="hidden",t.lockMovementY=!0,t.lockMovementX=!0,t.lockUniScaling=!0,t.borderColor="black",t.borderWidth=2,t.hasBorders=!1;var r=v.fabric.Textbox.prototype._render;v.fabric.Textbox.prototype._render=function(n){if(r.call(this,n),!this.active&&this.showTextBoxBorder){var o=this.width,a=this.height,s=-this.width/2,d=-this.height/2;n.beginPath(),n.moveTo(s,d),n.lineTo(s+o,d),n.lineTo(s+o,d+a),n.lineTo(s,d+a),n.lineTo(s,d),n.closePath();var l=n.strokeStyle;n.strokeStyle=this.textboxBorderColor,n.stroke(),n.strokeStyle=l}},t.splitByGrapheme=!0,t.borderColor="red",t.editingBorderColor="black",t.padding=2,t.showTextBoxBorder=!0,t.textboxBorderColor="black";const e=t.text.includes(")")?{id:t?.id,question:t?.text?.split(")")[0],value:t?.text?.split(")")[1]}:{id:null,value:""};this.answers.push(e),t.set("text",""),t.on("mousedown",n=>{n.target&&"textbox"===n.target.type&&n.target.enterEditing(),t.on("selected",function(o){this.canvas.renderAll()}),t.on("editing:entered",function(o){a.set("fontSize",a.fontSize);var a=this.canvas.getActiveObject();"Enter Text"==a.text&&(a.selectAll(),a.removeChars())}),t.on("editing:exited",()=>{t.set("fontSize",t.fontSize);const o={id:t.id,value:t.text},a=this.newanswers.findIndex(s=>s.id===t.id);-1!==a?this.newanswers[a]=o:this.newanswers.push(o),this.newanswers.push(o)}),t.on("changed",function(){t.set("fontSize",t.fontSize),this.canvas.getActiveObject(),this.canvas.renderAll()}),t.on("modified",function(){this.canvas.renderAll()})}),this.canvas.discardActiveObject()}else{t.selectable=!0,t.editable=!1,t.bringToFront(),this.dragAndDropObjects.push({id:t.id,text:t.text,obj:t});const n=t.left,o=t.top;t.on("modified",()=>{this.dragAndDropAreas.some(s=>{const d=s.obj.getBoundingRect(),l=t.getBoundingRect();return l.left>=d.left&&l.top>=d.top&&l.left+l.width<=d.left+d.width&&l.top+l.height<=d.top+d.height})||(t.animate("left",n,{duration:200,onChange:()=>{this.canvas.renderAll()}}),t.animate("top",o,{duration:200,onChange:()=>{this.canvas.renderAll()}}))})}else{t.selectable=!0,t.editable=!1,t.bringToFront(),this.dragAndDropObjects.push({id:t.id,text:t.text,obj:t});const n=t.left,o=t.top;t.on("modified",()=>{this.dragAndDropAreas.some(s=>{const d=s.obj.getBoundingRect(),l=t.getBoundingRect();return l.left>=d.left&&l.top>=d.top&&l.left+l.width<=d.left+d.width&&l.top+l.height<=d.top+d.height})||(t.animate("left",n,{duration:200,onChange:()=>{this.canvas.renderAll()}}),t.animate("top",o,{duration:200,onChange:()=>{this.canvas.renderAll()}}))})}}),this.canvas.renderAll()})}startRecording(){this.isRecording||(this.isRecording=!0,this.isSilenceLogged=!1,this.audioRecordingService.startRecording(),this.startSilenceDetection())}startSilenceDetection(){this.silenceInterval=setInterval(()=>{0===this.recordedChunks.length?this.isSilenceLogged||(console.log("User stopped speaking"),this.isSilenceLogged=!0,this.stopSilenceDetection(),this.stopRecording()):this.isSilenceLogged=!1},this.silenceDuration)}stopSilenceDetection(){if(this.silenceInterval){clearInterval(this.silenceInterval),clearInterval(this.blinkInterval),this.silenceInterval=null,this.blinkInterval=null;const t=this.canvas.getObjects().find(r=>r.id===this.activeMicIcon);console.log(t?._objects),t?._objects?.forEach(r=>{r?.set("fill","#000")})}}stopRecording(){this.isRecording&&(this.audioRecordingService.stopRecording(),this.isRecording=!1,this.audioRecordingService.getRecordedBlob().subscribe(i=>{const t=new FileReader;t.onloadend=()=>{const r=t.result.toString()?.split(",")[1];this.sendSpeechToTextRequest(r)},t.readAsDataURL(i.blob)}))}clearRecordedData(){this.blobUrl=null}abortRecording(){this.isRecording&&(this.isRecording=!1,this.audioRecordingService.abortRecording())}ngOnDestroy(){this.abortRecording()}sendTextoSpeechRequest(i,t,r){this.http.post("https://us-central1-texttospeech.googleapis.com/v1beta1/text:synthesize?key="+S.N.google_api_key,{audioConfig:{audioEncoding:"LINEAR16",effectsProfileId:["small-bluetooth-speaker-class-device"],pitch:0,speakingRate:1},input:{text:i},voice:{languageCode:t,name:r}},{headers:{"Content-Type":"application/json"}}).subscribe(s=>{if(s&&s.audioContent){const l=atob(s.audioContent),u=new ArrayBuffer(l.length),w=new Uint8Array(u);for(let f=0;f<l.length;f++)w[f]=l.charCodeAt(f);this.playAudio(w)}else console.log("No speech recognition results found.")},s=>{console.error("Speech-to-Text API request error:",s.message)})}sendSpeechToTextRequest(i){var t=new Headers;t.append("Content-Type","application/json");var r=JSON.stringify({audio:{content:i},config:{encoding:"LINEAR16",language_code:"en-US",audioChannelCount:1}});fetch(`https://speech.googleapis.com/v1p1beta1/speech:recognize?key=${S.N.google_api_key}`,{method:"POST",headers:t,body:r,redirect:"follow"}).then(n=>n.json()).then(n=>{this.transcription=n?.results[0]?.alternatives[0]?.transcript;let a=this.canvas.getObjects().find(l=>l.id===this.activeMic);a.set("text",n?.results[0]?.alternatives[0]?.transcript);const s={id:a.id,value:this.transcription},d=this.newanswers.findIndex(l=>l.id===a.id);-1!==d?this.newanswers[d]=s:this.newanswers.push(s),this.canvas.renderAll()}).catch(n=>{this.transcription="try again",this.canvas.renderAll()})}attemptWorksheet(){this.result=0,this.answerResult=0,this.checkboxResult=0,this.optionsResult=0,this.radioResult=0,this.dragAndDropResult=0,this.arrowResult=0,this.dropdownResult=0,this.canvas.discardActiveObject().renderAll(),this.checkBoxAnswers.length&&(this.checkboxResultCheck(),this.checkboxBackgroundChange()),this.radioAnswers.length&&(this.radioResultCheck(),this.radioBackgroundChange()),this.dragAndDropAreas.length&&(this.dragnDropResultCheck(),this.dragndropBackgroundChange()),this.answers.length&&(this.textboxResultCheck(),this.answersBackgroundChange()),this.correctOptions.length&&(this.mcqsResultCheck(),this.optionsBackgroundChange()),this.qArrows.length&&(this.arrowMatchResultCheck(),this.matchingArrowsBackgroundChange()),this.dropdownAnswers.length&&this.dropdownResultCheck(),this.wordSearchWords.length&&(this.wordSearchCheck(),this.wordSearchBackgroundChange()),this.total(),this.canvas.renderAll()}wordSearchCheck(){let i=0;for(const t of this.wordSearchWords){const r=t.word;let e=!0;for(const n of r){const o=this.searchUserLetter.find(s=>s.letter===n);if(!o){e=!1;break}const a=this.searchUserLetter.findIndex(s=>s.letter===o.letter);o&&(this.searchUserLetter[a].result=!0)}e&&i++}this.wordSearchResult=i}mcqsResultCheck(){let i={};for(let e=0;e<this.correctOptions.length;e++){const n=this.correctOptions[e].value.trim().toLowerCase();let o=!1;for(let d=0;d<this.userOptions.length;d++){const l=this.userOptions[d];if(l&&this.correctOptions[e].id===l.id){const u=l.value?l.value.trim().toLowerCase():"false";n===u?(this.correctOptions[e].result="true",o=!0):this.correctOptions[e].result="false"===n&&"true"===u||"true"===n&&"false"===u?"false":""}}let a=this.correctOptions[e].question,s=this.correctOptions[e].result;i[a]||(i[a]=[]),i[a].push(s)}const t={};for(let e=0;e<this.correctOptions.length;e++){const n=this.correctOptions[e],o=n.question;t[o]||(t[o]={totalOptions:0,trueOptions:0}),t[o].totalOptions++,("true"===n.value&&"true"===n.result||"false"===n.value&&"false"!==n.result)&&t[o].trueOptions++}for(const e in t){const{totalOptions:n,trueOptions:o}=t[e];if(n>0&&n===o){if(this.correctOptions.some(a=>a.question===e&&"false"===a.value&&"false"===a.result))continue;this.optionsResult++}}}radioResultCheck(){let i={};for(let e=0;e<this.radioAnswers.length;e++){const n=this.radioAnswers[e].value.trim().toLowerCase();let o=!1;for(let d=0;d<this.radioNewAnswers.length;d++){const l=this.radioNewAnswers[d];if(l&&this.radioAnswers[e].id===l.id){const u=l.value?l.value.trim().toLowerCase():"false";n===u?(this.radioAnswers[e].result="true",o=!0):this.radioAnswers[e].result="false"===n&&"true"===u||"true"===n&&"false"===u?"false":""}}let a=this.radioAnswers[e].question,s=this.radioAnswers[e].result;i[a]||(i[a]=[]),i[a].push(s)}const t={};for(let e=0;e<this.radioAnswers.length;e++){const n=this.radioAnswers[e],o=n.question;t[o]||(t[o]={totalOptions:0,trueOptions:0}),t[o].totalOptions++,("true"===n.value&&"true"===n.result||"false"===n.value&&"false"!==n.result)&&t[o].trueOptions++}for(const e in t){const{totalOptions:n,trueOptions:o}=t[e];if(n>0&&n===o){if(this.radioAnswers.some(a=>a.question===e&&"false"===a.value&&"false"===a.result))continue;this.radioResult++}}}textboxResultCheck(){let i=[],t={};for(let r=0;r<this.answers.length;r++){const e=this.answers[r].value.trim().toLowerCase();let n=!1;for(let s=0;s<this.newanswers.length;s++){const d=this.newanswers[s]?this.newanswers[s].value.trim().toLowerCase():"";if(this.answers[r].id===this.newanswers[s].id&&e===d){this.answers[r].result=!0,i.push(this.answers[r]),n=!0;break}if(this.answers[r].id===this.newanswers[s].id&&e!==d){this.answers[r].result=!1,i.push(this.answers[r]),n=!1;break}}let o=this.answers[r].question,a=this.answers[r].result;t[o]=t[o]?!0===t[o]&&!0===a:a}for(let r in t)t.hasOwnProperty(r)&&!0===t[r]&&this.answerResult++}dropdownResultCheck(){for(let i=0;i<this.dropdownAnswers.length;i++){const t=this.dropdownAnswers[i].answer.trim().toLowerCase(),r=this.dropdownAnswers[i].id;let e=!1;for(let n=0;n<this.dropdownUser.length;n++){const o=this.dropdownUser[n].answer.trim().toLowerCase();if(r===this.dropdownUser[n].id){t===o&&"true"===t&&(this.dropdownAnswers[i].result=!0,this.dropdownResult+=1),e=!0;break}}e||(this.dropdownAnswers[i].result=!1)}}arrowMatchResultCheck(){let i=[];for(const t of this.lineArrows){const r=this.qArrows.findIndex(e=>t.line.x1>=e.left&&t.line.x1<=e.right&&t.line.y1>=e.top&&t.line.y1<=e.bottom);if(-1!==r){const e=this.qArrows[r],n=this.aArrows.find(o=>t.line.x2>=o.left&&t.line.x2<=o.right&&t.line.y2>=o.top&&t.line.y2<=o.bottom);e&&n&&(i.includes(e.id)?console.log("No match found"):e.id===n.id?(this.qArrows[r].result=!0,this.arrowResult++,i.push(e.id)):this.qArrows[r].result=!1)}}}dragnDropResultCheck(){for(const i of this.dragAndDropObjects){const t=i.obj,r=this.dragAndDropAreas.findIndex(e=>e.text===i.text&&(e.id!==i.id||e.id===i.id));if(-1!==r){const e=this.dragAndDropAreas[r];t.left>=e.obj.left&&t.top>=e.obj.top&&t.top+t.height*t.scaleY<=e.obj.top+e.obj.height*e.obj.scaleY&&t.left+t.width*t.scaleX<=e.obj.left+e.obj.width*e.obj.scaleX?(this.dragAndDropResult++,this.dragAndDropAreas[r].result=!0):(console.log("The textbox is not inside the rectangle."),this.dragAndDropAreas[r].result=!1)}else console.log("Could not find drag and drop area.")}}checkboxResultCheck(){let i=[];for(let e=0;e<this.checkBoxAnswers.length;e++){const n=this.checkBoxAnswers[e].value;let o=!1;for(let a=0;a<this.checkBoxNewAnswers.length;a++)if(this.checkBoxAnswers[e].id===this.checkBoxNewAnswers[a].id&&n===(this.checkBoxNewAnswers[a]?this.checkBoxNewAnswers[a].value:"")){this.checkBoxAnswers[e].result=!0,o=!0;break}o||(this.checkBoxAnswers[e].result=!1),i.push(this.checkBoxAnswers[e])}let t={};for(let e=0;e<i.length;e++){let n=i[e],o=n.question,a=n.result,s=n.id;t[o]||(t[o]={}),t[o][s]||(t[o][s]={totalOptions:0,trueOptions:0}),t[o][s].totalOptions++,!0===a&&t[o][s].trueOptions++}let r=!0;for(let e in t)if(!Object.values(t[e]).some(a=>a.trueOptions>0)){r=!1;break}for(let e in t)Object.values(t[e]).every(a=>a.totalOptions===a.trueOptions)&&r&&this.checkboxResult++}matchingArrowsBackgroundChange(){let i=[],t=[];const r=this.canvas.getObjects();for(let e=0;e<this.qArrows.length;e++){const n=this.qArrows[e],o=r.filter(a=>a.id===n.id&&!1===n.result);i=i.concat(o)}for(let e=0;e<this.qArrows.length;e++){const n=this.qArrows[e],o=r.filter(a=>a.id===n.id&&!0===n.result);t=t.concat(o)}i.forEach(e=>{e.set({backgroundColor:"rgba(255,0,0,0.7)"})}),t.forEach(e=>{e.set({backgroundColor:"rgba(0,255,0,0.7)"})})}dragndropBackgroundChange(){let i=[],t=[];const r=this.canvas.getObjects();for(let e=0;e<this.dragAndDropAreas.length;e++){const n=this.dragAndDropAreas[e],o=r.filter(s=>s.id===n.id&&!0!==n.result),a=r.filter(s=>s.id===n.id&&!0===n.result);i=i.concat(o),t=i.concat(a)}i.forEach(e=>{e.set({backgroundColor:"rgba(255,0,0,0.7)"})})}answersBackgroundChange(){let i=[];const t=this.canvas.getObjects();for(let r=0;r<this.answers.length;r++){const e=this.answers[r],n=t.filter(o=>o.id===e.id&&!0!==e.result);i=i.concat(n)}i.forEach(r=>{r.set({backgroundColor:"rgba(255,0,0,0.7)"})})}wordSearchBackgroundChange(){let i=[],t=[];const r=this.canvas.getObjects();for(let e=0;e<this.searchUserLetter.length;e++){const n=this.searchUserLetter[e],o=r.filter(a=>a.id===n.letter&&!0===n.result);i=i.concat(o)}for(let e=0;e<this.searchUserLetter.length;e++){const n=this.searchUserLetter[e],o=r.filter(a=>a.id===n.letter&&!n.result);t=t.concat(o)}i.forEach(e=>{e.set({fill:"rgba(0, 255, 0, 0.7)"})}),t.forEach(e=>{e.set({fill:"rgba(255, 0, 0, 0.7)"})}),this.canvas.renderAll()}radioBackgroundChange(){let i=[];const t=this.canvas.getObjects();for(let r=0;r<this.radioAnswers.length;r++){const e=this.radioAnswers[r],n=t.filter(o=>o.id===e.id&&("false"===e.result||"true"===e.result));i=i.concat(n)}i.forEach(r=>{"false"===r.option?.split(")")[1]?r.set({fill:"rgba(255,0,0,0.7)"}):"true"===r.option?.split(")")[1]&&r.set({fill:"rgba(0,255,0,0.7)"})})}optionsBackgroundChange(){let i=[];const t=this.canvas.getObjects();for(let r=0;r<this.correctOptions.length;r++){const e=this.correctOptions[r],n=t.filter(o=>o.id===e.id&&("false"===e.result||"true"===e.result));i=i.concat(n)}i.forEach(r=>{"false"===r.option?.split(")")[1]?r.set({backgroundColor:"rgba(255,0,0,0.7)"}):"true"===r.option?.split(")")[1]&&r.set({backgroundColor:"rgba(0,255,0,0.7)"})})}checkboxBackgroundChange(){let i=[];const t=this.canvas.getObjects();for(let r=0;r<this.checkBoxAnswers.length;r++){const e=this.checkBoxAnswers[r],n=t.filter(o=>o.id===e.id&&(!1===e.result||!0===e.result));i=i.concat(n)}i.forEach(r=>{"false"===r.option?.split(")")[1]?r._objects[1].set({fill:"rgba(255,0,0,0.7)"}):"true"===r.option?.split(")")[1]&&r._objects[1].set({fill:"rgba(0,255,0,0.7)"})})}total(){this.result=this.answerResult+this.checkboxResult+this.optionsResult+this.radioResult+this.dragAndDropResult+this.arrowResult+this.dropdownResult+this.wordSearchResult,this.hidden=!1;for(let l in this.radioAnswers)this.radioAnswers&&"true"===this.radioAnswers[l].value&&this.radioQuestions++;let i=[];for(let l of this.correctOptions)"true"===l.value&&(i.includes(l.question)||i.push(l.question));this.mcQuestions=i.length;const r=new Set;for(const l of this.checkBoxAnswers)r.has(l.question)||r.add(l.question);this.checkBoxQuestions=r.size;let e=0;for(let l=0;l<this.dropdownAnswers.length;l++)"true"===this.dropdownAnswers[l].answer&&e++;let n={};for(let l=0;l<this.answers.length;l++){let u=this.answers[l],w=u.question;u.question&&(n[w]||(n[w]=!0,this.textboxQuestions++))}const a=new v.fabric.Textbox(`${this.result}/${this.checkBoxQuestions+this.textboxQuestions+this.mcQuestions+this.radioQuestions+this.dragAndDropAreas.length+this.qArrows.length+e+this.wordSearchWords.length}`,{left:120,top:150,fontSize:100,angle:0,fill:"red",fontFamily:"BrushScriptMT",borderColor:"black",originX:"center",originY:"center",padding:2}),s=new v.fabric.Circle({radius:100,left:120,top:150,fill:"transparent",stroke:"red",strokeWidth:4,originX:"center",originY:"center"}),d=new v.fabric.Group([s,a],{selectable:!1,editable:!1});this.canvas.add(d),this.canvas.renderAll()}retake(){location.reload(),this.result=0,this.answerResult=0,this.checkboxResult=0,this.radioResult=0,window.location.href=`#/worksheet-details/${this.sheetDetails._id}`}rasterize(){const i=new Image;i.src=this.canvas.toDataURL({format:"png"}),window.open("").document.write(i.outerHTML),this.downLoadImage()}downLoadImage(){const i=this.canvas.toDataURL({format:"png"}),t=document.createElement("a");document.body.appendChild(t),t.href=i,t.target="_self",t.download=Date.now()+".png",t.click()}downloadDataURL(i,t){const r=document.createElement("a");r.href=i,r.download=t,r.click()}rasterizeSVG(){return window.open("").document.write(this.canvas.toSVG()),this.downLoadSVG(),"data:image/svg+xml;utf8,"+encodeURIComponent(this.canvas.toSVG())}downLoadSVG(){const i="data:image/svg+xml;utf8,"+encodeURIComponent(this.canvas.toSVG()),t=document.createElement("a");document.body.appendChild(t),t.href=i,t.target="_self",t.download=Date.now()+".svg",t.click()}updateWorksheet(){this.router.navigate(["/updateworksheet",this.sheetDetails._id])}getSafeUrl(i){return this.sanitizer.bypassSecurityTrustResourceUrl(i)}showBasicDialog2(i){if(this.displayBasic2=!0,this.urls=i,this.urls.includes("youtube.com")){const r=new URL(this.urls).searchParams.get("v");this.safeurls=this.sanitizer.bypassSecurityTrustResourceUrl(`https://www.youtube.com/embed/${r}`)}}resetUrls(){this.urls="",this.safeurls=""}deleteWorksheet(){window.confirm("Are you sure you want to delete this item?")&&this.userService.deleteSheet(this.sheetDetails._id)}}return c.\u0275fac=function(i){return new(i||c)(h.Y36(W.gz),h.Y36(W.F0),h.Y36(T.eN),h.Y36(D.K),h.Y36(H.H7),h.Y36(O))},c.\u0275cmp=h.Xpm({type:c,selectors:[["app-worksheet-details"]],hostBindings:function(i,t){1&i&&h.NdJ("resize",function(e){return t.onResize(e)},!1,h.Jf7)},features:[h._Bn([O])],decls:14,vars:9,consts:[["claas","grid"],[1,"grid","col-12","flex-column","justify-content-center","align-items-center"],["id","canvas"],["htmlCanvas",""],[1,"col-12","flex","flex-wrap","justify-content-center","align-items-center","mx-auto"],["pButton","","label","Update Worksheet","icon","pi pi-save","type","button","class","p-2 text-xs border-0",3,"click",4,"ngIf"],["pButton","","label","Delete Worksheet","icon","pi pi-trash","type","button","class","p-2 text-xs border-0",3,"click",4,"ngIf"],["pButton","","label","Finish","icon","pi pi-save","type","button","class","p-2 text-xs border-0",3,"click",4,"ngIf"],["pButton","","label","Retake","icon","pi pi-replay","type","button","class","p-2 text-xs border-0",3,"click",4,"ngIf"],["header","Worksheet details",3,"visible","visibleChange","onHide"],[4,"ngIf"],["pButton","","label","Update Worksheet","icon","pi pi-save","type","button",1,"p-2","text-xs","border-0",3,"click"],["pButton","","label","Delete Worksheet","icon","pi pi-trash","type","button",1,"p-2","text-xs","border-0",3,"click"],["pButton","","label","Finish","icon","pi pi-save","type","button",1,"p-2","text-xs","border-0",3,"click"],["pButton","","label","Retake","icon","pi pi-replay","type","button",1,"p-2","text-xs","border-0",3,"click"],["id","myVideo","width","100%","height","100%","controls","","autoplay",""],["type","video/mp4",3,"src"],["id","myAudio","width","auto","height","100%","controls","","autoplay",""],["type","audio/mpeg",3,"src"],["width","560","height","315","title","YouTube video player","frameborder","0","allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share","allowfullscreen","",3,"src"]],template:function(i,t){1&i&&(h.TgZ(0,"div",0)(1,"div",1),h._UZ(2,"canvas",2,3),h.TgZ(4,"div",4),h.YNc(5,_,1,0,"button",5),h.YNc(6,L,1,0,"button",6),h.YNc(7,b,1,0,"button",7),h.YNc(8,U,1,0,"button",8),h.qZA()()(),h.TgZ(9,"p-dialog",9),h.NdJ("visibleChange",function(e){return t.displayBasic2=e})("onHide",function(){return t.resetUrls()}),h.YNc(10,N,4,1,"div",10),h.YNc(11,M,4,1,"div",10),h.YNc(12,z,4,1,"div",10),h.YNc(13,Y,2,1,"div",10),h.qZA()),2&i&&(h.xp6(5),h.Q6J("ngIf",t.isAdmin),h.xp6(1),h.Q6J("ngIf",t.isAdmin),h.xp6(1),h.Q6J("ngIf",t.hidden),h.xp6(1),h.Q6J("ngIf",!t.hidden),h.xp6(1),h.Q6J("visible",t.displayBasic2),h.xp6(1),h.Q6J("ngIf",t.urls&&t.urls.trim()&&t.urls.endsWith(".mp4")),h.xp6(1),h.Q6J("ngIf",t.urls&&t.urls.trim()&&t.urls.endsWith(".mp3")),h.xp6(1),h.Q6J("ngIf",t.urls&&t.urls.trim()&&t.urls.endsWith(".m4a")),h.xp6(1),h.Q6J("ngIf",t.urls&&t.urls.trim()&&!t.urls.endsWith(".mp4")&&!t.urls.endsWith(".mp3")&&!t.urls.endsWith(".m4a")&&t.urls.includes("youtube.com")))},dependencies:[Z.O5,q.Hq,I.V]}),c})()}];let F=(()=>{class c{}return c.\u0275fac=function(i){return new(i||c)},c.\u0275mod=h.oAB({type:c}),c.\u0275inj=h.cJS({imports:[W.Bz.forChild(E),W.Bz]}),c})()}}]);